class SwiftChatbot{constructor(){this.sessionId=null;this.isOpen=false;this.messages=[];this.isTyping=false;this.init();}async init(){this.createWidget();await this.createSession();this.addEventListeners();await this.loadSuggestions();}createWidget(){const chatbotHTML=` <!-- Chatbot Toggle Button --> <div id="chatbot-toggle" class="chatbot-toggle"> <i class="fas fa-comments"></i> <span class="chatbot-badge">1</span> </div> <!-- Chatbot Widget --> <div id="chatbot-widget" class="chatbot-widget"> <div class="chatbot-header"> <div class="chatbot-header-info"> <div class="chatbot-avatar"> <i class="fas fa-robot"></i> </div> <div class="chatbot-title"> <h4>Swift Assistant</h4> <span class="chatbot-status">Online</span> </div> </div> <button id="chatbot-close" class="chatbot-close"> <i class="fas fa-times"></i> </button> </div> <div class="chatbot-messages" id="chatbot-messages"> <!-- Messages will be added here --> </div> <div class="chatbot-suggestions" id="chatbot-suggestions"> <!-- Suggestions will be loaded here --> </div> <div class="chatbot-input-container"> <input type="text" id="chatbot-input" placeholder="Type your message..." maxlength="500"> <button id="chatbot-send" class="chatbot-send-btn"> <i class="fas fa-paper-plane"></i> </button> </div> <div class="chatbot-footer"> <small>Powered by Swift Agency AI</small> </div> </div> `;document.body.insertAdjacentHTML('beforeend',chatbotHTML);this.addStyles();}addStyles(){const styles=` <style> .chatbot-toggle{position: fixed;bottom: 20px;right: 20px;width: 60px;height: 60px;background: linear-gradient(135deg,#667eea 0%,#764ba2 100%);border-radius: 50%;display: flex;align-items: center;justify-content: center;cursor: pointer;box-shadow: 0 4px 20px rgba(102,126,234,0.4);z-index: 9999;transition: all 0.3s ease;animation: pulse 2s infinite;}.chatbot-toggle:hover{transform: scale(1.1);box-shadow: 0 6px 25px rgba(102,126,234,0.6);}.chatbot-toggle i{color: white;font-size: 24px;}.chatbot-badge{position: absolute;top: -5px;right: -5px;background: #ff4757;color: white;border-radius: 50%;width: 20px;height: 20px;display: flex;align-items: center;justify-content: center;font-size: 12px;font-weight: bold;}.chatbot-widget{position: fixed;bottom: 90px;right: 20px;width: 350px;height: 500px;background: white;border-radius: 15px;box-shadow: 0 10px 40px rgba(0,0,0,0.2);z-index: 9998;display: none;flex-direction: column;overflow: hidden;animation: slideUp 0.3s ease;}.chatbot-widget.open{display: flex;}.chatbot-header{background: linear-gradient(135deg,#667eea 0%,#764ba2 100%);color: white;padding: 15px;display: flex;align-items: center;justify-content: space-between;}.chatbot-header-info{display: flex;align-items: center;gap: 10px;}.chatbot-avatar{width: 40px;height: 40px;background: rgba(255,255,255,0.2);border-radius: 50%;display: flex;align-items: center;justify-content: center;}.chatbot-title h4{margin: 0;font-size: 16px;}.chatbot-status{font-size: 12px;opacity: 0.8;}.chatbot-close{background: none;border: none;color: white;cursor: pointer;padding: 5px;border-radius: 50%;transition: background 0.3s ease;}.chatbot-close:hover{background: rgba(255,255,255,0.2);}.chatbot-messages{flex: 1;padding: 15px;overflow-y: auto;display: flex;flex-direction: column;gap: 10px;}.chatbot-message{max-width: 80%;padding: 10px 15px;border-radius: 15px;word-wrap: break-word;animation: fadeIn 0.3s ease;}.chatbot-message.user{background: linear-gradient(135deg,#667eea 0%,#764ba2 100%);color: white;align-self: flex-end;border-bottom-right-radius: 5px;}.chatbot-message.bot{background: #f1f3f4;color: #333;align-self: flex-start;border-bottom-left-radius: 5px;}.chatbot-typing{display: flex;align-items: center;gap: 5px;padding: 10px 15px;background: #f1f3f4;border-radius: 15px;align-self: flex-start;max-width: 80px;}.chatbot-typing-dot{width: 8px;height: 8px;background: #999;border-radius: 50%;animation: typing 1.4s infinite;}.chatbot-typing-dot:nth-child(2){animation-delay: 0.2s;}.chatbot-typing-dot:nth-child(3){animation-delay: 0.4s;}.chatbot-suggestions{padding: 10px 15px;border-top: 1px solid #eee;display: flex;flex-wrap: wrap;gap: 5px;}.chatbot-suggestion{background: #f8f9fa;border: 1px solid #dee2e6;border-radius: 15px;padding: 5px 10px;font-size: 12px;cursor: pointer;transition: all 0.3s ease;}.chatbot-suggestion:hover{background: #667eea;color: white;border-color: #667eea;}.chatbot-input-container{padding: 15px;border-top: 1px solid #eee;display: flex;gap: 10px;}.chatbot-input-container input{flex: 1;padding: 10px 15px;border: 1px solid #ddd;border-radius: 25px;outline: none;font-size: 14px;}.chatbot-input-container input:focus{border-color: #667eea;}.chatbot-send-btn{width: 40px;height: 40px;background: linear-gradient(135deg,#667eea 0%,#764ba2 100%);border: none;border-radius: 50%;color: white;cursor: pointer;display: flex;align-items: center;justify-content: center;transition: transform 0.3s ease;}.chatbot-send-btn:hover{transform: scale(1.1);}.chatbot-send-btn:disabled{opacity: 0.5;cursor: not-allowed;transform: none;}.chatbot-footer{padding: 10px;text-align: center;background: #f8f9fa;border-top: 1px solid #eee;}.chatbot-footer small{color: #666;font-size: 11px;}@keyframes pulse{0%{box-shadow: 0 4px 20px rgba(102,126,234,0.4);}50%{box-shadow: 0 4px 25px rgba(102,126,234,0.6);}100%{box-shadow: 0 4px 20px rgba(102,126,234,0.4);}}@keyframes slideUp{from{transform: translateY(20px);opacity: 0;}to{transform: translateY(0);opacity: 1;}}@keyframes fadeIn{from{opacity: 0;transform: translateY(10px);}to{opacity: 1;transform: translateY(0);}}@keyframes typing{0%,60%,100%{transform: translateY(0);}30%{transform: translateY(-10px);}}@media (max-width: 480px){.chatbot-widget{width: calc(100vw - 40px);height: calc(100vh - 120px);bottom: 90px;right: 20px;left: 20px;}}</style> `;document.head.insertAdjacentHTML('beforeend',styles);}addEventListeners(){const toggle=document.getElementById('chatbot-toggle');const close=document.getElementById('chatbot-close');const input=document.getElementById('chatbot-input');const sendBtn=document.getElementById('chatbot-send');toggle.addEventListener('click',()=> this.toggleWidget());close.addEventListener('click',()=> this.closeWidget());sendBtn.addEventListener('click',()=> this.sendMessage());input.addEventListener('keypress',(e)=>{if (e.key==='Enter'){this.sendMessage();}});document.addEventListener('click',(e)=>{if (e.target.classList.contains('chatbot-suggestion')){this.sendMessage(e.target.textContent);}});}async createSession(){try{const response=await fetch('/api/?path=chat/create',{method: 'POST',headers:{'Content-Type': 'application/json'}});const result=await response.json();if (result.success){this.sessionId=result.sessionId;this.addMessage(result.welcomeMessage,'bot');setTimeout(()=>{const badge=document.querySelector('.chatbot-badge');if (badge) badge.style.display='none';},3000);}}catch (error){console.error('Failed to create chatbot session:',error);}}async loadSuggestions(){try{const response=await fetch('/api/?path=chat/suggestions');const result=await response.json();if (result.success){const suggestionsContainer=document.getElementById('chatbot-suggestions');suggestionsContainer.innerHTML=result.suggestions .map(suggestion=> `<span class="chatbot-suggestion">${suggestion}</span>`) .join('');}}catch (error){console.error('Failed to load suggestions:',error);}}toggleWidget(){const widget=document.getElementById('chatbot-widget');const badge=document.querySelector('.chatbot-badge');if (this.isOpen){this.closeWidget();}else{widget.classList.add('open');this.isOpen=true;if (badge) badge.style.display='none';setTimeout(()=>{document.getElementById('chatbot-input').focus();},300);}}closeWidget(){const widget=document.getElementById('chatbot-widget');widget.classList.remove('open');this.isOpen=false;}async sendMessage(messageText=null){const input=document.getElementById('chatbot-input');const message=messageText || input.value.trim();if (!message || this.isTyping) return;this.addMessage(message,'user');input.value='';this.showTyping();try{const response=await fetch('/api/?path=chat/send',{method: 'POST',headers:{'Content-Type': 'application/json'},body: JSON.stringify({message,sessionId: this.sessionId})});const result=await response.json();this.hideTyping();if (result.success){this.addMessage(result.response,'bot');}else{this.addMessage('Sorry,I\'m having trouble responding right now. Please try again.','bot');}}catch (error){this.hideTyping();this.addMessage('Sorry,I\'m experiencing technical difficulties. Please try again later.','bot');console.error('Chatbot error:',error);}}addMessage(text,sender){const messagesContainer=document.getElementById('chatbot-messages');const messageDiv=document.createElement('div');messageDiv.className=`chatbot-message ${sender}`;messageDiv.textContent=text;messagesContainer.appendChild(messageDiv);messagesContainer.scrollTop=messagesContainer.scrollHeight;this.messages.push({text,sender,timestamp: new Date()});}showTyping(){if (this.isTyping) return;this.isTyping=true;const messagesContainer=document.getElementById('chatbot-messages');const typingDiv=document.createElement('div');typingDiv.className='chatbot-typing';typingDiv.id='chatbot-typing-indicator';typingDiv.innerHTML=` <div class="chatbot-typing-dot"></div> <div class="chatbot-typing-dot"></div> <div class="chatbot-typing-dot"></div> `;messagesContainer.appendChild(typingDiv);messagesContainer.scrollTop=messagesContainer.scrollHeight;}hideTyping(){this.isTyping=false;const typingIndicator=document.getElementById('chatbot-typing-indicator');if (typingIndicator){typingIndicator.remove();}}}document.addEventListener('DOMContentLoaded',()=>{if (!window.location.pathname.includes('booking')){new SwiftChatbot();}});